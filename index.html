<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini 3 Pro - 绘图工作台（全能修复版 + XHS + BananaPrompt）</title>
    <!-- 引入 Markdown 解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="mobile-header">
        <div onclick="toggleLeftSidebar()" style="padding:8px; cursor:pointer; margin-top:3px;">
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
        <div style="display:flex; align-items:center; gap:6px; flex:1; margin-left:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="width:20px; height:20px;"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
            <span style="font-weight:bold; font-size:14px;">Gemini 3 Pro</span>
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
            <a href="https://github.com/Tansuo2021/gemini-3-pro-image-preview" target="_blank" style="padding:8px; cursor:pointer; text-decoration:none; color:inherit; display:flex; align-items:center;" title="GitHub 开源">
                <svg viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
            </a>
            <div onclick="createNewSession()" style="padding:8px; cursor:pointer; display:flex; align-items:center;" title="新建对话">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </div>
            <div onclick="toggleSettings()" style="padding:8px; cursor:pointer; display:flex; align-items:center;">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeAllSidebars()"></div>

    <nav class="sidebar-nav" id="left-sidebar">
        <div class="new-chat-btn" onclick="createNewSession()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            <span>新建对话</span>
        </div>

        <!-- 创作工具分组 -->
        <div class="nav-section-title">创作工具</div>

        <div class="nav-card xhs-nav-card" onclick="XHSCreator.open()">
            <div class="nav-card-icon xhs-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
            </div>
            <div class="nav-card-content">
                <div class="nav-card-title">XHS 灵感实验室</div>
                <div class="nav-card-desc">小红书风格内容创作</div>
            </div>
        </div>

        <div class="nav-card banana-nav-card" onclick="BananaTool.open()">
            <div class="nav-card-icon banana-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
            </div>
            <div class="nav-card-content">
                <div class="nav-card-title">提示词快查</div>
                <div class="nav-card-desc">快速查找优质提示词</div>
            </div>
        </div>

        <div class="nav-card custom-nav-card" onclick="CustomPromptTool.open()">
            <div class="nav-card-icon custom-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                </svg>
            </div>
            <div class="nav-card-content">
                <div class="nav-card-title">我的提示词</div>
                <div class="nav-card-desc">管理个人提示词库</div>
            </div>
        </div>

        <div class="nav-card feature-nav-card" onclick="activateStickerMode()">
            <div class="nav-card-icon feature-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                    <line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/>
                </svg>
            </div>
            <div class="nav-card-content">
                <div class="nav-card-title">制作表情包</div>
                <div class="nav-card-desc">快速生成表情包</div>
            </div>
        </div>

        <div class="nav-card tool-nav-card" onclick="SlicerTool.openLocal()">
            <div class="nav-card-icon tool-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/>
                    <line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/>
                    <line x1="8.12" y1="8.12" x2="12" y2="12"/>
                </svg>
            </div>
            <div class="nav-card-content">
                <div class="nav-card-title">图片切片</div>
                <div class="nav-card-desc">九宫格切图工具</div>
            </div>
        </div>
        <div style="padding:0 12px; font-size:11px; font-weight:600; color:#5f6368; margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
            <span>最近对话</span>
            <button onclick="clearAllSessions()" style="background: none; border: none; color: #d93025; cursor: pointer; font-size: 11px; padding: 2px 6px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='#fce8e6'" onmouseout="this.style.background='none'" title="清除全部对话">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                清空
            </button>
        </div>
        <div class="session-list" id="session-list"></div>
    </nav>

    <main class="main-area">
        <div class="desktop-header">
            <div class="brand-area">
                <svg class="brand-logo-small" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                <span>Gemini 3 Pro</span>
            </div>
            <div class="header-actions">
                <a href="https://github.com/Tansuo2021/gemini-3-pro-image-preview" target="_blank" class="header-icon-btn" title="GitHub 开源" style="text-decoration: none; color: inherit;">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                </a>
                <div class="header-icon-btn" title="新建对话" onclick="createNewSession()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </div>
                <div class="header-icon-btn" title="设置" onclick="toggleSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </div>
            </div>
        </div>

        <div class="chat-container" id="chat-history">
            <div class="empty-state" id="empty-state">
                <svg class="google-logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                <h1>gemini-3-pro-image-preview</h1>
                <p>并发生成 · 4K 渲染 · 本地存储</p>
            </div>
        </div>

        <div class="input-container-outer">
            <div class="preview-area" id="preview-area"></div>
            <div class="input-wrapper">
                <div class="icon-btn" title="上传参考图" onclick="document.getElementById('file-input').click()">
                    <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" fill="none" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                </div>
                <input type="file" id="file-input" accept="image/*" multiple onchange="handleFiles(this.files)">
                <textarea id="user-input" placeholder="描述画面..." rows="1"></textarea>
                <div class="icon-btn send-btn" id="send-btn" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </div>
            </div>
        </div>
    </main>

    <aside class="settings-sidebar" id="right-sidebar">
        <div class="settings-inner">
            <h2 style="font-size:16px; font-weight:600; margin-bottom:24px; color:#202124;">绘图设置</h2>
            <button class="theme-toggle-btn" onclick="toggleTheme()">
                <svg class="theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="theme-icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
                <span id="theme-toggle-text">切换暗黑模式</span>
            </button>
            <details class="provider-collapse">
                <summary>API 渠道管理</summary>
                <div class="provider-content">
                    <label class="config-label" style="color:#1967d2;">当前使用渠道</label>
                    <select id="provider-select" class="provider-selector" onchange="ProviderManager.select(this.value)">
                        <option value="random">🎲 随机优选 (自动轮询)</option>
                    </select>
                    <label class="config-label" style="margin-top:10px;">渠道列表</label>
                    <div id="provider-list" class="provider-list"></div>
                    <div class="api-input-group">
                        <input type="hidden" id="p-id">
                        <input type="text" id="p-name" placeholder="渠道名称 (如: 官方API)">
                        <select id="p-type" class="provider-selector" style="margin-bottom:10px;">
                            <option value="gemini">Gemini 原生接口</option>
                            <option value="openai">OpenAI 兼容接口</option>
                        </select>
                        <input type="text" id="p-host" placeholder="API Base URL (https://...)">
                        <input type="password" id="p-key" placeholder="API Key (sk-...)">
                        <select id="p-model-select" onchange="document.getElementById('p-model').value = this.value" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px;">
                            <option value="">-- 选择预设模型或在下方自定义 --</option>
                            <option value="gemini-2.5-flash-image">gemini-2.5-flash-image</option>
                            <option value="gemini-3-pro-image-preview">gemini-3-pro-image-preview</option>
                        </select>
                        <input type="text" id="p-model" placeholder="Model (e.g. gemini-3-pro-image-preview)">
                    </div>
                    <div class="action-row">
                        <button class="config-btn" onclick="ProviderManager.clearForm()">清空/新增</button>
                        <button class="config-btn primary" onclick="ProviderManager.save()">保存渠道</button>
                        <button class="config-btn danger" onclick="ProviderManager.del()">删除</button>
                    </div>
                </div>
            </details>
            <label class="config-label">OpenAI 流式传输</label>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 24px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: #444; user-select: none;">
                    <input type="checkbox" id="stream-toggle" style="width: 16px; height: 16px; cursor: pointer;">
                    <span>启用流式接收（整体解析图片）</span>
                </label>
            </div>

            <label class="config-label">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                对话上下文
            </label>
            <div style="margin-bottom: 24px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: #444; user-select: none; margin-bottom: 12px;">
                    <input type="checkbox" id="context-toggle" style="width: 16px; height: 16px; cursor: pointer;">
                    <span>启用对话上下文（AI可记住历史对话）</span>
                </label>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <label style="font-size: 12px; color: #666; min-width: 80px;">保留条数：</label>
                    <select id="context-count" style="flex: 1; padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; background: #fff;">
                        <option value="3">最近 3 条对话</option>
                        <option value="5" selected>最近 5 条对话</option>
                        <option value="10">最近 10 条对话</option>
                        <option value="20">最近 20 条对话</option>
                    </select>
                </div>
                <div style="font-size: 11px; color: #888; line-height: 1.4;">
                    💡 启用后，AI可以基于之前的对话和图片继续创作<br>
                    ⚠️ 保留条数越多，消耗的 Token 越多
                </div>
            </div>

            <label class="config-label">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                自动保存到本地
            </label>
            <div style="margin-bottom: 24px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: #444; user-select: none; margin-bottom: 12px;">
                    <input type="checkbox" id="auto-save-toggle" style="width: 16px; height: 16px; cursor: pointer;">
                    <span>启用自动保存（不占用浏览器空间）</span>
                </label>
                <button class="config-btn" onclick="FileSystemManager.selectDirectory()" style="width: 100%; margin-bottom: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    选择保存目录
                </button>
                <div id="selected-dir-path" style="font-size: 12px; color: #666; padding: 8px; background: #fff; border-radius: 4px; word-break: break-all; display: none;">
                    <strong>当前目录：</strong><span id="dir-path-text">未选择</span>
                </div>
                <div style="font-size: 11px; color: #888; margin-top: 8px; line-height: 1.4;">
                    💡 启用后，生成的图片将自动保存到选择的目录<br>
                    ⚠️ 需要 Chrome 86+ 或 Edge 86+ 浏览器支持
                </div>
            </div>

            <label class="config-label">分辨率</label>
            <div class="res-selector">
                <div class="res-btn" data-val="1024x1024">1K</div>
                <div class="res-btn" data-val="2048x2048">2K</div>
                <div class="res-btn active" data-val="4K">4K</div>
            </div>
            <label class="config-label">长宽比 (默认 Auto)</label>
            <div class="ratio-grid">
                <div class="ratio-card active" data-val="auto"><div class="icon-box icon-auto"></div><span class="ratio-text">Auto</span></div>
                <div class="ratio-card" data-val="21:9"><div class="icon-box icon-21-9"></div><span class="ratio-text">21:9</span></div>
                <div class="ratio-card" data-val="16:9"><div class="icon-box icon-16-9"></div><span class="ratio-text">16:9</span></div>
                <div class="ratio-card" data-val="3:2"><div class="icon-box icon-3-2"></div><span class="ratio-text">3:2</span></div>
                <div class="ratio-card" data-val="4:3"><div class="icon-box icon-4-3"></div><span class="ratio-text">4:3</span></div>
                <div class="ratio-card" data-val="5:4"><div class="icon-box icon-5-4"></div><span class="ratio-text">5:4</span></div>
                <div class="ratio-card" data-val="1:1"><div class="icon-box icon-1-1"></div><span class="ratio-text">1:1</span></div>
                <div class="ratio-card" data-val="4:5"><div class="icon-box icon-4-5"></div><span class="ratio-text">4:5</span></div>
                <div class="ratio-card" data-val="3:4"><div class="icon-box icon-3-4"></div><span class="ratio-text">3:4</span></div>
                <div class="ratio-card" data-val="2:3"><div class="icon-box icon-2-3"></div><span class="ratio-text">2:3</span></div>
                <div class="ratio-card" data-val="9:16"><div class="icon-box icon-9-16"></div><span class="ratio-text">9:16</span></div>
            </div>
        </div>
    </aside>

    <!-- XHS Modal - V7 三栏布局 -->
    <div id="xhs-modal" class="xhs-modal">
        <div class="xhs-header">
            <div class="xhs-toggle-btn" onclick="toggleXHSSidebar()" title="展开/收起侧栏（文案生成配置/历史记录）">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/></svg>
            </div>
            <div class="xhs-title-bar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:#ff2e4d;"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                <span style="margin-left:8px;">XHS 灵感实验室</span>
            </div>
            <div class="xhs-header-actions">
                <div class="xhs-toggle-btn" onclick="toggleSettings(true)" title="打开右侧设置（API 渠道管理）">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </div>
                <div class="xhs-toggle-btn" onclick="XHSCreator.close()" title="关闭">✕</div>
            </div>
        </div>

        <div class="xhs-sidebar-overlay" id="xhs-sidebar-overlay" onclick="toggleXHSSidebar()"></div>
        <div class="xhs-layout">
            <!-- Left: Settings & History -->
            <div class="xhs-sidebar collapsed" id="xhs-sidebar">
                <div class="xhs-sidebar-inner">
                    <details class="xhs-config-card" style="cursor:pointer;" open>
                        <summary class="xhs-section-label" style="list-style:none; user-select:none;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/></svg>
                            文案生成 API（可选）
                        </summary>
                        <div style="margin-top:12px;">
                            <div class="config-group">
                                <label>API Base URL</label>
                                <input class="xhs-input" id="xhs-text-api-host" placeholder="https://api.openai.com">
                            </div>
                            <div class="config-group">
                                <label>API Key</label>
                                <input class="xhs-input" type="password" id="xhs-text-api-key" placeholder="sk-...">
                            </div>
                            <div class="config-group">
                                <label>快速选择模型</label>
                                <select id="xhs-text-model-quick" class="xhs-input" onchange="XHSCreator.quickSelectModel(this.value)">
                                    <option value="">选择常用模型...</option>
                                    <optgroup label="Google Gemini">
                                        <option value="gemini-3-pro-preview">gemini-3-pro-preview</option>
                                    </optgroup>
                                    <optgroup label="OpenAI">
                                        <option value="gpt-4o">gpt-4o</option>
                                        <option value="gpt-5.1">gpt-5.1</option>
                                    </optgroup>
                                    <optgroup label="Anthropic Claude">
                                        <option value="claude-3-5-sonnet-20241022">claude-3-5-sonnet-20241022</option>
                                        <option value="claude-3-5-haiku-20241022">claude-3-5-haiku-20241022</option>
                                        <option value="claude-sonnet-4-5">claude-sonnet-4-5</option>
                                    </optgroup>
                                    <optgroup label="自定义模型" id="xhs-custom-models-group" style="display:none;">
                                    </optgroup>
                                </select>
                            </div>
                            <div class="config-group">
                                <label>模型名称</label>
                                <select class="xhs-input" id="xhs-text-model-select" onchange="document.getElementById('xhs-text-model').value = this.value" style="margin-bottom: 8px;">
                                    <option value="">-- 选择预设模型或在下方自定义 --</option>
                                    <option value="gemini-2.5-flash-image">gemini-2.5-flash-image</option>
                                    <option value="gemini-3-pro-image-preview">gemini-3-pro-image-preview</option>
                                </select>
                                <input class="xhs-input" id="xhs-text-model" placeholder="输入或选择模型名称">
                            </div>
                            <div style="display:flex;gap:8px;margin-bottom:12px;">
                                <button class="config-btn" style="flex:1;padding:6px 12px;font-size:12px;" onclick="XHSCreator.addCustomModel()">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                    添加
                                </button>
                                <button class="config-btn danger" style="flex:1;padding:6px 12px;font-size:12px;" onclick="XHSCreator.removeCustomModel()">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                    删除
                                </button>
                            </div>
                            <button class="xhs-save-btn" onclick="XHSCreator.saveTextSettings()">保存配置</button>
                            <div style="font-size:11px;color:#888;margin-top:12px;line-height:1.4;">
                                💡 提示：这里是可选的文案独立配置（OpenAI 兼容接口）<br>
                                📌 未填写时，默认使用右侧“API 渠道管理”的配置生成文案<br>
                                ✨ 可将常用模型添加到快速选择列表
                            </div>
                        </div>
                    </details>
                    <div class="xhs-section-label">
                        <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/></svg>历史记录</span>
                        <span style="cursor:pointer;color:#d93025" onclick="XHSCreator.clearHistory()">清空</span>
                    </div>
                    <div id="xhs-history-list"></div>
                </div>
            </div>

            <!-- Middle: Input & Text -->
            <div class="xhs-middle">
                <div class="xhs-middle-content">
                    <div class="xhs-input-box">
                        <div class="xhs-section-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>灵感输入</div>
                        <textarea class="xhs-textarea-lg" id="xhs-topic" placeholder="输入你的想法，例如："分析图片，生成复古风格的OOTD文案"..."></textarea>

                        <div class="xhs-upload-row">
                            <div class="xhs-upload-btn" onclick="document.getElementById('xhs-file-input').click()">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            </div>
                            <input type="file" id="xhs-file-input" hidden multiple accept="image/*" onchange="XHSCreator.handleFiles(this.files)">
                            <div id="xhs-previews" style="display:flex;gap:8px;"></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
                            <div style="font-size:12px;color:#666">图片数量: <input type="number" id="xhs-img-count" value="4" min="1" max="9" style="width:40px;padding:4px;border:1px solid #ddd;border-radius:4px;text-align:center"></div>
                            <button class="xhs-action-btn" id="xhs-generate-btn" style="width:auto; padding:8px 24px; margin-top:0;" onclick="XHSCreator.generateOutline()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>生成方案</button>
                        </div>
                    </div>

                    <div id="xhs-text-result">
                        <div class="xhs-section-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>文案预览</div>
                        <div class="xhs-copy-group">
                            <button class="xhs-mini-btn" onclick="XHSCreator.copyContent('title')">复制标题</button>
                            <button class="xhs-mini-btn" onclick="XHSCreator.copyContent('content')">复制正文</button>
                        </div>
                        <div id="xhs-content-viewer" style="font-size:14px;line-height:1.6;color:#333"></div>
                    </div>
                </div>
            </div>

            <!-- Right: Visual Wall -->
            <div class="xhs-right">
                <div class="xhs-gallery-bar">
                    <div style="font-weight:700; color:#333; display:flex; align-items:center;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>分镜</div>
                    <div class="xhs-gallery-opts">
                        <select id="xhs-paint-ratio" class="xhs-select">
                            <option value="3:4">3:4 (默认)</option><option value="1:1">1:1</option><option value="16:9">16:9</option>
                            <option value="9:16">9:16</option><option value="4:3">4:3</option><option value="3:2">3:2</option>
                            <option value="2:3">2:3</option><option value="21:9">21:9</option><option value="5:4">5:4</option><option value="4:5">4:5</option>
                        </select>
                        <select id="xhs-paint-quality" class="xhs-select">
                            <option value="1K">1K (标准)</option><option value="2K">2K (高清)</option><option value="4K">4K (超清)</option>
                        </select>
                        <button class="xhs-mini-btn" style="background:#1a73e8;color:white;border:none;height:36px;padding:0 16px;display:flex;align-items:center;gap:6px;" onclick="XHSCreator.startPainting()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>批量生成</button>
                    </div>
                </div>
                <div class="shot-grid" id="xhs-shot-list"></div>
            </div>
        </div>
    </div>

    <!-- Banana Prompt Modal -->
    <div id="banana-modal" class="xhs-modal">
        <div class="slice-header-bar">
            <div class="slice-title">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px; color:#d97706;"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                <span>提示词快查</span>
                <a href="https://github.com/glidea/banana-prompt-quicker" target="_blank"
                   style="margin-left:12px; font-size:12px; color:#6b7280; text-decoration:none; display:flex; align-items:center; gap:4px; border:1px solid #e5e7eb; padding:4px 10px; border-radius:15px; transition:all 0.2s;">
                    <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                    <span>GitHub</span>
                </a>
            </div>
            <div class="slice-close" onclick="BananaTool.close()">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
        </div>
        <div style="flex: 1; display: flex; flex-direction: column; max-width: 1200px; margin: 0 auto; width: 100%; padding: 24px; overflow-y: auto; padding-top: 80px;">
             <div class="banana-search-wrapper">
                 <svg class="banana-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                     <circle cx="11" cy="11" r="8"></circle>
                     <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                 </svg>
                 <input type="text" class="banana-search-input" placeholder="搜索关键词 (标题、提示词、分类)..." oninput="BananaTool.handleSearch(this.value)">
             </div>

             <div id="banana-source-tabs" class="banana-source-tabs">
                 <div class="banana-source-tab active" data-source-id="banana_online">banana-prompt-quicker</div>
                 <div class="banana-source-tab" data-source-id="local_prompts_json">OpenNana</div>
                 <div class="banana-source-tab" data-source-id="local_prompts2_md">YouMind</div>
             </div>

              <div id="banana-category-tabs" class="banana-tabs"></div>
            <div id="banana-loading" style="text-align:center; padding:40px; color:#666;">
                <div class="loading-spinner" style="margin:0 auto 10px auto;"></div>
                正在加载提示词...
            </div>
             <div id="banana-error" style="text-align:center; padding:40px; color:#d93025; display:none;">
                 加载失败，请稍后重试
                <br><button class="config-btn" onclick="BananaTool.fetchData({forceReload:true})" style="margin-top:10px; width:auto; padding:6px 20px;">重试</button>
             </div>
            <div id="banana-grid" class="banana-grid"></div>
        </div>
    </div>

    <!-- Custom Prompt Modal -->
    <div id="custom-prompt-modal" class="xhs-modal">
        <div class="slice-header-bar">
            <div class="slice-title">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px; color:#9333ea;"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                <span>我的提示词</span>
            </div>
            <div class="slice-close" onclick="CustomPromptTool.close()">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
        </div>
        <div style="flex: 1; display: flex; flex-direction: column; max-width: 1200px; margin: 0 auto; width: 100%; padding: 24px; overflow-y: auto; padding-top: 80px;">
            <!-- 添加/编辑区域 -->
            <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    <span id="custom-prompt-form-title">新建提示词</span>
                </div>
                <input type="hidden" id="custom-prompt-edit-id" value="">
                <div style="margin-bottom: 12px;">
                    <label style="display: block; font-size: 12px; color: #666; margin-bottom: 6px;">标题</label>
                    <input type="text" id="custom-prompt-title" class="xhs-input" placeholder="例如：人物肖像生成" style="margin-bottom: 0;">
                </div>
                <div style="margin-bottom: 12px;">
                    <label style="display: block; font-size: 12px; color: #666; margin-bottom: 6px;">提示词内容</label>
                    <textarea id="custom-prompt-content" class="xhs-textarea-lg" placeholder="输入你的提示词内容..." style="min-height: 80px; border: 1px solid #dadce0; border-radius: 6px; padding: 10px;"></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="config-btn primary" style="flex: 1;" onclick="CustomPromptTool.save()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        保存
                    </button>
                    <button class="config-btn" style="flex: 1;" onclick="CustomPromptTool.clearForm()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        清空
                    </button>
                </div>
            </div>

            <!-- 搜索框 -->
            <div class="banana-search-wrapper" style="margin-bottom: 20px;">
                <svg class="banana-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" class="banana-search-input" placeholder="搜索提示词..." oninput="CustomPromptTool.handleSearch(this.value)">
            </div>

            <!-- 提示词列表 -->
            <div id="custom-prompt-list" class="banana-grid"></div>
            <div id="custom-prompt-empty" style="text-align:center; padding:60px 20px; color:#999; display:none;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin:0 auto 16px; opacity:0.3;">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                <div style="font-size: 14px; margin-bottom: 8px;">还没有保存的提示词</div>
                <div style="font-size: 12px; color: #aaa;">在上方添加你的常用提示词</div>
            </div>
        </div>
    </div>

    <!-- Slicer Modal -->
    <div id="slice-modal">
        <div class="slice-header-bar">
            <div class="slice-title">
                <svg width="22" height="22" style="margin-right:8px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>
                图片分割工厂
            </div>
            <div class="slice-close" onclick="SlicerTool.close()">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
        </div>
        <div class="slice-scroll-area">
            <div class="slice-toolbar">
                <input type="file" id="slice-file-input" accept="image/*" style="display:none" onchange="SlicerTool.handleFile(this.files)">
                <button class="slice-action-btn secondary" onclick="document.getElementById('slice-file-input').click()">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    更换图片
                </button>
                <div class="slice-btn-group">
                    <label class="radio-label active" onclick="SlicerTool.setMode('horizontal', this)"><input type="radio" name="slice-mode" value="horizontal" checked> <span>横线 —</span></label>
                    <label class="radio-label" onclick="SlicerTool.setMode('vertical', this)"><input type="radio" name="slice-mode" value="vertical"> <span>竖线 |</span></label>
                </div>
                <div class="slice-btn-group">
                    <label class="radio-label" style="display:flex; align-items:center; gap:4px;"><input type="checkbox" id="slice-force-square" style="margin:0;"> <span>1:1 补全</span></label>
                    <div id="slice-color-picker-box" style="display:none; align-items: center; padding: 0 8px;">
                        <input type="color" id="slice-bg-color" value="#ffffff" style="width:24px; height:24px; padding:0; border:none; cursor:pointer;">
                    </div>
                </div>
                <button class="slice-action-btn secondary" id="slice-clear-btn">清空辅助线</button>
                <button class="slice-action-btn primary" id="slice-process-btn" disabled>⚡ 生成切片</button>
                <button class="slice-action-btn download-all" id="slice-download-all-btn" disabled onclick="SlicerTool.downloadAll()">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    一键打包下载
                </button>
            </div>
            <div id="slice-editor-container">
                <div id="slice-empty-msg" onclick="document.getElementById('slice-file-input').click()">
                    <div style="margin-bottom:10px;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#dadce0" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                    </div>
                    <div>点击上传本地图片</div>
                </div>
                <img id="slice-source-image" src="" alt="Source" style="display:none;" crossorigin="anonymous">
                <div id="slice-overlay-canvas"></div>
            </div>
            <div id="slice-result-grid"></div>
        </div>
    </div>

    <div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-img" id="lightbox-image" src="" onclick="event.stopPropagation()">
    </div>
    
    <!-- Toast 提示 -->
    <div id="toast" class="toast-msg"></div>

    <!-- 全局加载遮罩 -->
    <div id="global-loading" class="global-loading">
        <div class="global-loading-spinner"></div>
        <div class="global-loading-text" id="global-loading-text">加载中...</div>
    </div>

    <!-- 进度条 -->
    <div id="progress-bar-container" class="progress-bar-container">
        <div id="progress-bar" class="progress-bar"></div>
    </div>

<script src="app.js"></script>

</body>
</html>
